VARIABLE DECLARATIONS
	ALPHANUMERIC -
	NUMERIC -

MAIN
	INIT
	WHILE MORE-RECS = "YES"
		MAINLINE
	CLOSING

INIT
	OPEN INPUT FILE
	OPEN OUTPUT FILE
	REQUEST SYSTEM DATE
	GET I-DATE
	O-DATE = I-DATE
	READ
	HEADINGS
	ERR-HEADINGS

MAINLINE
	PERFORM VALIDATION THRU 2100-X.
	IF ERR-SW = "NO"
		PERFORM CALCS
		PERFORM OUTPUT
	ELSE
		PERFORM ERR-ROUT
		C-ERR-COUNT++
	PERFORM READ.

VALIDATION
	MOVE "YES" TO ERR-SW
	IF I-LNAME = SPACES
		MOVE "LAST NAME REQUIRED." TO O-ERR
		GO TO 2100-X
	ELSE
		IF I-FNAME = SPACES
			MOVE "FIRST NAME REQUIRED." TO O-ERR
			GO TO 2100-X
		ELSE
			IF I-ADDRESS = SPACES
				MOVE "ADDRESS REQUIRED." TO O-ERR
				GO TO 2100-X
			ELSE
				IF I-CITY = SPACES
					MOVE "CITY REQUIRED." TO O-ERR
					GO TO 2100-X
				ELSE
					IF I-ZIP NOT = "IA" OR I-ZIP NOT = "IL" OR I-ZIP NOT = "MI" OR I-ZIP NOT = "NE" OR I-ZIP NOT = "WI"
						MOVE "MUST BE A STATE. (IA, IL, MI, NE, WI)" TO O-ERR
						GO TO 2100-X
					ELSE
						IF I-POP-TYPE = 1-6
							MOVE "POP TYPE MUST BE A NUMBER FROM 1 TO 6." TO O-ERR
							GO TO 2100-X
						ELSE
							IF I-#CASES > 1
								MOVE "NUMBER OF CASES MUST BE A NUMBER GREATER THAN 1." TO O-ERR
								GO TO 2100-X
							ELSE
								IF I-TEAM = "A"-"E"
									MOVE "TEAM NAME MUST BE A LETTER FROM A TO E." TO O-ERR
									GO TO 2100-X
								ELSE
									MOVE "NO" TO ERR-SW.

2100-X
	EXIT.

CALCS
	C-BOTTLES = 24 * I-#CASES
	EVALUATE I-STATE
		WHEN "IA" OR "NE" OR "WI"
			C-DEPOSIT-AMT = .05
		WHEN "MI"
			C-DEPOSIT-AMT = .1
		DEFAULT
			C-DEPOSIT-AMT = 0.

	C-DEPOSIT-AMT = C-DEPOSIT-AMT * C-BOTTLES.
	C-TOT-SALES = C-DEPOSIT-AMT + I-#CASES * 18.71.

	EVALUATE I-POP-TYPE
		WHEN 1
			C-GT-QTY-COKE++
			O-POP-TYPE = "COKE"
		WHEN 2
			C-GT-QTY-DTCOKE++
			O-POP-TYPE = "DIET COKE"
		WHEN 3
			C-GT-QTY-MELLOW++
			O-POP-TYPE = "MELLOW YELLOW"
		WHEN 4
			C-GT-QTY-CHERRY-COKE
			O-POP-TYPE = "CHERRY COKE"
		WHEN 5
			C-GT-QTY-CHERRY-DTCOKE++
			O-POP-TYPE = "DIET CHERRY COKE"
		WHEN 6
			C-GT-QTY-SPRITE++
			O-POP-TYPE = "SPRITE".

	EVALUATE I-TEAM
		WHEN "A"
			C-GT-TEAM-A += C-TOT-SALES
		WHEN "B"
			C-GT-TEAM-B += C-TOT-SALES
		WHEN "C"
			C-GT-TEAM-C += C-TOT-SALES
		WHEN "D"
			C-GT-TEAM-D += C-TOT-SALES
		WHEN "E"
			C-GT-TEAM-E += C-TOT-SALES.

OUTPUT
	O-LNAME = I-LNAME
	O-FNAME = I-FNAME
	O-CITY = I-CITY
	O-STATE = I-STATE
	O-ZIP = I-ZIP
	O-QTY = I-#CASES
	O-DEPOSIT-AMT = C-DEPOSIT-AMT
	O-TOT-SALES = C-TOT-SALES

	PRINT DETAIL LINE O-LNAME, O-FNAME, O-CITY, O-STATE, O-ZIP, O-POP-TYPE, O-QTY, O-DEPOSIT-AMT, O-TOT-SALES.
		AT EOP
			CALL HEADINGS.
	PRINT BLANK LINE.

ERR-ROUT
	PRINT ERROR-LINE TO ERR-FILE ERR-REC, O-ERR
		AT EOP
			CALL ERROR-HEADINGS.

ERROR-HEADINGS
	C-ERR-PCTR += 1
	O-ERR-PCTR = C-PCTR
	PRINT TITLE LINE
	PRINT DIVISION LINE
	PRINT REPORT LINE
	PRINT BLANK LINE
	PRINT ERROR COLUMN HEADING LINE
	PRINT BLANK LINE

CLOSING
	GRANDTOTALS
	CLOSE INPUT FILE
	CLOSE OUTPUT FILE

GRANDTOTALS
	O-GT-QTY-COKE = C-GT-QTY-COKE
	O-GT-QTY-DTCOKE = C-GT-QTY-DTCOKE
	O-GT-QTY-MELLOW = C-GT-QTY-MELLOW
	O-GT-QTY-CHERRY-COKE = C-GT-QTY-CHERRY-COKE
	O-GT-QTY-CHERRY-DTCOKE = C-GT-QTY-CHERRY-DTCOKE
	O-GT-QTY-SPRITE = C-GT-QTY-SPRITE
	O-GT-TEAM-A = C-GT-TEAM-A
	O-GT-TEAM-B = C-GT-TEAM-B
	O-GT-TEAM-C = C-GT-TEAM-C
	O-GT-TEAM-D = C-GT-TEAM-D
	O-GT-TEAM-E = C-GT-TEAM-E
	O-ERR-COUNT = C-ERR-COUNT

	PERFORM HEADINGS
		AFTER ADVANCING 1 PAGE.
	PRINT GRAND TOTAL LINE O-GT-QTY-COKE, O-GT-QTY-DTCOKE, O-GT-QTY-MELLOW, O-GT-QTY-CHERRY-COKE, O-GT-QTY-CHERRY-DTCOKE, O-GT-QTY-SPRITE
		O-GT-TEAM-A, O-GT-TEAM-B, O-GT-TEAM-C, O-GT-TEAM-D, O-GT-TEAM-E.

	PRINT ERROR-TOTAL LINE O-ERR-COUNT.

READ
	READ RECORD, I-LNAME, I-FNAME, I-ADDRESS, I-CITY, I-STATE, I-ZIP, I-POP-TYPE, I-#CASES, I-TEAM
	IF END OF FILE
		MORE-RECTS = "NO"
HEADINGS
	C-PCTR += 1
	O-PCTR = C-PCTR
	PRINT TITLE LINE
	DIVISION LINE
	REPORT LINE
	PRINT BLANK LINE
	PRINT COLUMN HEADING LINE
	PRINT BLANK LINE
